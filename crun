running () { [ -f restapi.pyw.pid ] && ps p "$(cat restapi.pyw.pid)" >/dev/null; return $?; }

command="$1"
#echo "$command"
shift
#running; echo $?

case "$command" in
  ensure | start | "")
    if running; then
      echo "server already running (pid $(cat restapi.pyw.pid))" 
    else
      { python3 restapi.pyw &
      echo $! > restapi.pyw.pid
      echo "server started (pid $!)" >&3
      } 3>/dev/stdout |& grep -qe 'Running on'
    fi
  ;;

  stop | kill)
    if running; then
      kill "$@" $(cat restapi.pyw.pid)
      rm restapi.pyw.pid
      echo "killed server"
    else
      echo "server not running"
    fi
  ;;
  *)
    echo "error: unknown command: $command"
    exit 2
esac